<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css" media="screen" />
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script type="text/javascript">
    console.log('test123');
    var url_string = window.location.href
    var url = new URL(url_string);
    var m = url.searchParams.get("m");
    var g = url.searchParams.get("g");
    var month;
    if(m == '2019-04') {
        month = '2019-04-01';
    }
    else if(m == '2019-03') {
        month = '2019-03-04';
    }
    else if(m == '2019-02') {
        month = '2019-02-04';
    }
    else if(m == '2019-01') {
        month = '2019-01-07';
    }

    var arrTableData = [];
    loadData(month,g);

    google.charts.load('current', {'packages':['table']});
    google.charts.setOnLoadCallback(drawTable);
        
    function loadData(m,g) {
    	var s = "./2017to2019Risk_data_weekly/"+m+"/all_groups/"+g+"/top5_etf_list.csv";
    	alert(s);
        $.ajax({
            async: false,
            type: "GET",  
            url: "./2017to2019Risk_data_weekly/"+m+"/all_groups/"+g+"/top5_etf_list.csv",
            dataType: "text",       
            success: function(response) {
                var arrDataTemp = $.csv.toArrays(response);
                for(var i=1; i<arrDataTemp.length; i++) {
                    etf_name = arrDataTemp[i][0];
                    r_string = arrDataTemp[i][1];
                    r_number = r_string.replace("[","").replace("]","");
                    riskiness_r = parseFloat(r_number*100);
                    link = '<a href="weekly_return.htm?m='+m+'&etf='+etf_name+'&g='+g+'" target="_blank">detail</a>';
                    arrTableData.push([etf_name,riskiness_r,link]);
                }
            }   
        });
    }
        
    function drawTable() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'ETF Name');
        data.addColumn('number', 'Riskiness R');
        data.addColumn('string', 'Detail');
        data.addRows(arrTableData);
        var options = {
            showRowNumber: true,
            allowHtml: true,
            width: 800,
            height: 400
        }
        var table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(data, options);
    }    
    </script>
  </head>
  <body>
    <div id='custom-title'>- ETF Investment Profolio -</div>
    <div class="space"></div>
    <div class="custom-head"><h3>Top 5 ETF List</h3></div>
    <div class="custom-head" id="etf_head"></div>
    <div id="table_div"></div>
  </body>
  <script type="text/javascript">
    var e = document.getElementById('etf_head');
    e.innerHTML = m+' / '+g;   
  </script> 
</html>